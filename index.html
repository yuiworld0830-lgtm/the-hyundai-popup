<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>더현대 서울 팝업 라이브</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-50 pb-20">
    
    <header class="p-6 bg-white shadow-sm flex justify-between items-center sticky top-0 z-50">
        <h1 class="text-xl font-black italic tracking-tighter text-gray-900">THE HYUNDAI <span class="text-emerald-600">POP-UP</span></h1>
        <div id="status-dot" class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></div>
    </header>

    <main id="app" class="p-4 space-y-10">
        <div id="msg" class="py-20 text-center text-gray-500 font-bold animate-pulse">데이터를 읽는 중입니다...</div>
    </main>

    <script>
        const app = document.getElementById('app');
        const msg = document.getElementById('msg');
        const dot = document.getElementById('status-dot');

        // 외부 링크 대신, 같은 깃허브에 올린 data.csv 파일을 바로 읽어옵니다.
        Papa.parse("data.csv", {
            download: true,
            header: true,
            complete: function(results) {
                const data = results.data;
                const layers = { "B2": [], "1F": [], "5F": [], "6F": [] };
                let hasData = false;

                data.forEach(item => {
                    const floor = String(item['층'] || '').trim().toUpperCase();
                    // 빈 줄 제외하고 데이터가 있는 경우만 추가
                    if(floor && layers[floor]) {
                        layers[floor].push(item);
                        hasData = true;
                    }
                });

                if(!hasData) {
                    msg.innerText = "데이터가 없습니다. data.csv 파일 내용을 확인해주세요.";
                    return;
                }

                app.innerHTML = '';
                
                Object.keys(layers).forEach(floor => {
                    if(layers[floor].length === 0) return;
                    
                    const section = document.createElement('section');
                    section.innerHTML = `
                        <h2 class="text-3xl font-black mb-4 px-2 italic text-gray-900">${floor}</h2>
                        <div class="flex overflow-x-auto snap-x snap-mandatory gap-4 px-2 pb-4 hide-scroll" style="scrollbar-width: none;">
                            ${layers[floor].map(item => `
                                <div class="snap-center shrink-0 w-[85%] md:w-[320px] bg-white rounded-3xl shadow-md border border-gray-100 overflow-hidden">
                                    <div class="relative h-80 bg-gray-200">
                                        <img src="${item['이미지URL']}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/400x600?text=THE+HYUNDAI'">
                                        <div class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-lg text-xs font-black tracking-widest shadow-md">LIVE</div>
                                    </div>
                                    <div class="p-6">
                                        <h3 class="text-xl font-bold mb-1 text-gray-900">${item['팝업이름'] || '이름 없음'}</h3>
                                        <p class="text-sm font-semibold text-gray-500">${item['공간명'] || ''} | ${item['시작일'] || ''}~${item['종료일'] || ''}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>`;
                    app.appendChild(section);
                });

                // 성공 시 초록색 불 켜기
                dot.classList.replace('bg-red-500', 'bg-green-500');
                dot.classList.remove('animate-pulse');
            },
            error: function(err) {
                msg.innerHTML = "데이터를 찾을 수 없습니다.<br>깃허브에 <b>data.csv</b> 파일이 정확히 올라갔는지 확인해 주세요.";
                dot.classList.replace('animate-pulse', 'bg-red-500');
            }
        });
    </script>
</body>
</html>
